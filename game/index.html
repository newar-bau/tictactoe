<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAZY TIC TAC TOE CHAOS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Creepster&family=Bungee&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #ff0080, #ff8c00, #40e0d0, #ff0080);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            position: relative;
            margin: 0 auto;
        }
        
        /* Menu Styles */
        .menu {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.7);
            border: 2px solid #ff00ff;
            animation: pulse 2s infinite alternate;
            position: relative;
            overflow: hidden;
        }
        
        .menu::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            border-radius: 20px;
            opacity: 0.7;
            z-index: -1;
            animation: rotate 4s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.7); }
            100% { box-shadow: 0 0 40px rgba(0, 255, 255, 0.7); }
        }
        
        .menu h1 {
            font-family: 'Creepster', cursive;
            font-size: 3rem;
            margin-bottom: 30px;
            color: #ff00ff;
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.7);
            letter-spacing: 3px;
            animation: glitch 2s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { text-shadow: 0 0 15px rgba(255, 0, 255, 0.7); }
            25% { text-shadow: -2px 0 #00ffff, 2px 0 #ff00ff; }
            50% { text-shadow: 2px 0 #00ffff, -2px 0 #ff00ff; }
            75% { text-shadow: 0 0 15px rgba(255, 0, 255, 0.7); }
        }
        
        .menu-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .menu-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
            z-index: -1;
        }
        
        .menu-button:hover::before {
            transform: translateX(0);
        }
        
        .menu-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 0, 255, 0.5);
        }
        
        /* Game Styles */
        .game {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .game-title {
            font-family: 'Bungee', cursive;
            font-size: 2rem;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
            animation: rainbow 3s infinite;
        }
        
        @keyframes rainbow {
            0% { color: #ff0000; }
            16% { color: #ff8c00; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            66% { color: #00ffff; }
            83% { color: #0000ff; }
            100% { color: #ff0000; }
        }
        
        .back-button {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: rgba(255, 0, 255, 0.3);
            transform: scale(1.1);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .player-name {
            font-size: 1.2rem;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        }
        
        .player-symbol {
            font-size: 2.5rem;
            font-weight: 900;
            transition: all 0.3s ease;
        }
        
        .current-player {
            animation: playerPulse 1s infinite alternate;
        }
        
        @keyframes playerPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 15px;
            margin-bottom: 30px;
            perspective: 1000px;
        }
        
        .cell {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 2px solid #ff00ff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }
        
        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .cell:hover::before {
            opacity: 1;
        }
        
        .cell:hover {
            transform: rotateY(10deg) rotateX(10deg) scale(1.05);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.7);
        }
        
        .cell.x {
            color: #ff0080;
            text-shadow: 0 0 15px rgba(255, 0, 128, 0.9);
            animation: xAnimation 1s ease;
        }
        
        .cell.o {
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.9);
            animation: oAnimation 1s ease;
        }
        
        @keyframes xAnimation {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        @keyframes oAnimation {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-button {
            padding: 12px 25px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .control-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }
        
        .control-button:hover::before {
            transform: translateX(0);
        }
        
        .control-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 0, 255, 0.5);
        }
        
        /* Special Power Buttons */
        .power-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .power-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #ffff00;
            background: rgba(0, 0, 0, 0.7);
            color: #ffff00;
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .power-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.7);
        }
        
        .power-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .power-button.disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        /* Difficulty Selection */
        .difficulty {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .difficulty h2 {
            font-family: 'Bungee', cursive;
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
            animation: rainbow 3s infinite;
        }
        
        .difficulty-button {
            display: block;
            width: 100%;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff00ff;
            border-radius: 15px;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .difficulty-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 0, 255, 0.3), rgba(0, 255, 255, 0.3));
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }
        
        .difficulty-button:hover::before {
            transform: translateX(0);
        }
        
        .difficulty-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 0, 255, 0.5);
        }
        
        /* Game Over Modal */
        .game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .game-over-content {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.3), rgba(0, 255, 255, 0.3));
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.7);
            border: 3px solid #ff00ff;
            animation: slideIn 0.5s ease-in-out, pulse 2s infinite alternate;
            position: relative;
            overflow: hidden;
        }
        
        .game-over-content::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            border-radius: 20px;
            opacity: 0.7;
            z-index: -1;
            animation: rotate 4s linear infinite;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-100px) rotate(-10deg);
                opacity: 0;
            }
            to {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
        }
        
        .game-over h2 {
            font-family: 'Creepster', cursive;
            font-size: 3rem;
            margin-bottom: 30px;
            color: #ff00ff;
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.9);
            animation: glitch 2s infinite;
        }
        
        .game-over p {
            font-size: 2rem;
            margin-bottom: 40px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        }
        
        .game-over-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .game-over-button {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .game-over-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }
        
        .game-over-button:hover::before {
            transform: translateX(0);
        }
        
        .game-over-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 0, 255, 0.5);
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff00ff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.7);
        }
        
        .sound-toggle i {
            font-size: 1.5rem;
            color: #00ffff;
        }
        
        /* Crazy Effects */
        .explosion {
            position: fixed;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.8) 0%, rgba(255, 0, 0, 0.5) 50%, transparent 70%);
            animation: explode 0.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        
        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(5);
                opacity: 0;
            }
        }
        
        .screen-shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Power Up Notifications */
        .power-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffff00;
            border-radius: 15px;
            padding: 20px;
            color: #ffff00;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            z-index: 1000;
            animation: notification 2s ease-out forwards;
        }
        
        @keyframes notification {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
        
        /* Score Display */
        .score-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 2px solid #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }
        
        .score {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffff00;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.7);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .menu h1 {
                font-size: 2.5rem;
            }
            
            .cell {
                font-size: 3rem;
            }
            
            .game-title {
                font-size: 1.5rem;
            }
            
            .difficulty h2 {
                font-size: 2rem;
            }
            
            .game-over h2 {
                font-size: 2.5rem;
            }
            
            .game-over p {
                font-size: 1.5rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="bg-animation"></div>
    <div class="floating-shapes" id="floatingShapes"></div>
    
    <div class="container">
        <div class="sound-toggle" id="soundToggle">
            <i class="fas fa-volume-up"></i>
        </div>
        
        <!-- Main Menu -->
        <div class="menu" id="mainMenu">
            <h1>CRAZY TIC TAC TOE</h1>
            <button class="menu-button" id="singlePlayerBtn">SINGLE PLAYER</button>
            <button class="menu-button" id="multiPlayerBtn">MULTIPLAYER</button>
            <button class="menu-button" id="crazyModeBtn">CRAZY MODE</button>
        </div>
        
        <!-- Difficulty Selection -->
        <div class="difficulty" id="difficultyScreen">
            <h2>SELECT DIFFICULTY</h2>
            <button class="difficulty-button" id="easyBtn">EASY</button>
            <button class="difficulty-button" id="mediumBtn">MEDIUM</button>
            <button class="difficulty-button" id="hardBtn">HARD</button>
            <button class="difficulty-button" id="insaneBtn">INSANE</button>
            <button class="back-button" id="backToMenuBtn">BACK TO MENU</button>
        </div>
        
        <!-- Game Screen -->
        <div class="game" id="gameScreen">
            <div class="game-header">
                <div class="game-title" id="gameTitle">SINGLE PLAYER</div>
                <button class="back-button" id="backToMenuFromGameBtn">MENU</button>
            </div>
            
            <div class="score-display">
                <div class="score" id="player1Score">Player 1: 0</div>
                <div class="score" id="player2Score">Computer: 0</div>
            </div>
            
            <div class="game-info">
                <div class="player-info" id="player1Info">
                    <div class="player-name">Player 1</div>
                    <div class="player-symbol x">X</div>
                </div>
                
                <div class="player-info" id="player2Info">
                    <div class="player-name" id="player2Name">Computer</div>
                    <div class="player-symbol o">O</div>
                </div>
            </div>
            
            <div class="power-controls">
                <div class="power-button" id="bombPower" title="Bomb: Clears a random cell">
                    <i class="fas fa-bomb"></i>
                </div>
                <div class="power-button" id="swapPower" title="Swap: Switches all X's and O's">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="power-button" id="freezePower" title="Freeze: Skips opponent's next turn">
                    <i class="fas fa-snowflake"></i>
                </div>
                <div class="power-button" id="doublePower" title="Double: Places two marks in one turn">
                    <i class="fas fa-clone"></i>
                </div>
            </div>
            
            <div class="board" id="gameBoard">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
            
            <div class="game-controls">
                <button class="control-button" id="resetBtn">RESET GAME</button>
                <button class="control-button" id="newGameBtn">NEW GAME</button>
            </div>
        </div>
        
        <!-- Game Over Modal -->
        <div class="game-over" id="gameOverModal">
            <div class="game-over-content">
                <h2 id="gameOverTitle">GAME OVER</h2>
                <p id="gameOverMessage">PLAYER X WINS!</p>
                <div class="game-over-buttons">
                    <button class="game-over-button" id="playAgainBtn">PLAY AGAIN</button>
                    <button class="game-over-button" id="backToMenuFromGameOverBtn">MAIN MENU</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let gameActive = true;
        let gameMode = ''; // 'single', 'multi', 'crazy'
        let difficulty = ''; // 'easy', 'medium', 'hard', 'insane'
        let soundEnabled = true;
        let musicEnabled = true;
        let player1Score = 0;
        let player2Score = 0;
        let frozen = false;
        let doubleMove = false;
        let powerUps = {
            bomb: true,
            swap: true,
            freeze: true,
            double: true
        };
        
        // DOM Elements
        const mainMenu = document.getElementById('mainMenu');
        const difficultyScreen = document.getElementById('difficultyScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverModal = document.getElementById('gameOverModal');
        const gameTitle = document.getElementById('gameTitle');
        const player2Name = document.getElementById('player2Name');
        const cells = document.querySelectorAll('.cell');
        const player1Info = document.getElementById('player1Info');
        const player2Info = document.getElementById('player2Info');
        const player1ScoreEl = document.getElementById('player1Score');
        const player2ScoreEl = document.getElementById('player2Score');
        const gameOverTitle = document.getElementById('gameOverTitle');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const soundToggle = document.getElementById('soundToggle');
        const soundIcon = soundToggle.querySelector('i');
        const floatingShapes = document.getElementById('floatingShapes');
        
        // Power buttons
        const bombPower = document.getElementById('bombPower');
        const swapPower = document.getElementById('swapPower');
        const freezePower = document.getElementById('freezePower');
        const doublePower = document.getElementById('doublePower');
        
        // Sound Effects
        const sounds = {
            click: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3'),
            win: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3'),
            draw: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3'),
            move: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3'),
            explosion: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-explosion-hit-759.mp3'),
            powerUp: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-power-up-sparkle-891.mp3'),
            freeze: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-ice-hit-763.mp3'),
            swap: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3')
        };
        
        // Background Music - Using bgmusic.mp3 as requested
        const backgroundMusic = new Audio('bgmusic.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.3;
        
        // Create floating shapes
        function createFloatingShapes() {
            const shapes = ['circle', 'square', 'triangle'];
            const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff0080', '#80ff00'];
            
            for (let i = 0; i < 20; i++) {
                const shape = document.createElement('div');
                shape.classList.add('shape');
                
                const shapeType = shapes[Math.floor(Math.random() * shapes.length)];
                const size = Math.random() * 100 + 50;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const left = Math.random() * 100;
                const animationDuration = Math.random() * 20 + 10;
                const animationDelay = Math.random() * 5;
                
                shape.style.width = `${size}px`;
                shape.style.height = `${size}px`;
                shape.style.left = `${left}%`;
                shape.style.animationDuration = `${animationDuration}s`;
                shape.style.animationDelay = `${animationDelay}s`;
                
                if (shapeType === 'circle') {
                    shape.style.borderRadius = '50%';
                    shape.style.backgroundColor = color;
                } else if (shapeType === 'square') {
                    shape.style.backgroundColor = color;
                } else if (shapeType === 'triangle') {
                    shape.style.width = '0';
                    shape.style.height = '0';
                    shape.style.borderLeft = `${size/2}px solid transparent`;
                    shape.style.borderRight = `${size/2}px solid transparent`;
                    shape.style.borderBottom = `${size}px solid ${color}`;
                }
                
                floatingShapes.appendChild(shape);
            }
        }
        
        // Create explosion effect
        function createExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.classList.add('explosion');
            explosion.style.left = `${x}px`;
            explosion.style.top = `${y}px`;
            document.body.appendChild(explosion);
            
            setTimeout(() => {
                explosion.remove();
            }, 500);
        }
        
        // Create confetti effect
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 3}s`;
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        // Create power up notification
        function showPowerNotification(message) {
            const notification = document.createElement('div');
            notification.classList.add('power-notification');
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }
        
        // Screen shake effect
        function screenShake() {
            document.body.classList.add('screen-shake');
            setTimeout(() => {
                document.body.classList.remove('screen-shake');
            }, 500);
        }
        
        // Event Listeners
        document.getElementById('singlePlayerBtn').addEventListener('click', () => {
            gameMode = 'single';
            showDifficultyScreen();
            playSound('click');
        });
        
        document.getElementById('multiPlayerBtn').addEventListener('click', () => {
            gameMode = 'multi';
            startGame();
            playSound('click');
        });
        
        document.getElementById('crazyModeBtn').addEventListener('click', () => {
            gameMode = 'crazy';
            showDifficultyScreen();
            playSound('click');
        });
        
        document.getElementById('easyBtn').addEventListener('click', () => {
            difficulty = 'easy';
            startGame();
            playSound('click');
        });
        
        document.getElementById('mediumBtn').addEventListener('click', () => {
            difficulty = 'medium';
            startGame();
            playSound('click');
        });
        
        document.getElementById('hardBtn').addEventListener('click', () => {
            difficulty = 'hard';
            startGame();
            playSound('click');
        });
        
        document.getElementById('insaneBtn').addEventListener('click', () => {
            difficulty = 'insane';
            startGame();
            playSound('click');
        });
        
        document.getElementById('backToMenuBtn').addEventListener('click', () => {
            showMainMenu();
            playSound('click');
        });
        
        document.getElementById('backToMenuFromGameBtn').addEventListener('click', () => {
            showMainMenu();
            playSound('click');
        });
        
        document.getElementById('backToMenuFromGameOverBtn').addEventListener('click', () => {
            showMainMenu();
            playSound('click');
        });
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            resetGame();
            playSound('click');
        });
        
        document.getElementById('newGameBtn').addEventListener('click', () => {
            if (gameMode === 'single' || gameMode === 'crazy') {
                showDifficultyScreen();
            } else {
                startGame();
            }
            playSound('click');
        });
        
        document.getElementById('playAgainBtn').addEventListener('click', () => {
            resetGame();
            playSound('click');
        });
        
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            musicEnabled = !musicEnabled;
            updateSoundIcon();
            playSound('click');
            
            if (musicEnabled) {
                backgroundMusic.play().catch(e => console.log("Music play error:", e));
            } else {
                backgroundMusic.pause();
            }
        });
        
        // Power up event listeners
        bombPower.addEventListener('click', () => {
            if (powerUps.bomb && gameActive) {
                useBombPower();
            }
        });
        
        swapPower.addEventListener('click', () => {
            if (powerUps.swap && gameActive) {
                useSwapPower();
            }
        });
        
        freezePower.addEventListener('click', () => {
            if (powerUps.freeze && gameActive) {
                useFreezePower();
            }
        });
        
        doublePower.addEventListener('click', () => {
            if (powerUps.double && gameActive) {
                useDoublePower();
            }
        });
        
        cells.forEach(cell => {
            cell.addEventListener('click', () => {
                if (gameActive && cell.textContent === '') {
                    makeMove(cell);
                }
            });
        });
        
        // Functions
        function showMainMenu() {
            mainMenu.style.display = 'block';
            difficultyScreen.style.display = 'none';
            gameScreen.style.display = 'none';
            gameOverModal.style.display = 'none';
            
            // Reset scores
            player1Score = 0;
            player2Score = 0;
            updateScoreDisplay();
            
            // Start background music when menu is shown
            if (musicEnabled) {
                backgroundMusic.play().catch(e => console.log("Music play error:", e));
            }
        }
        
        function showDifficultyScreen() {
            mainMenu.style.display = 'none';
            difficultyScreen.style.display = 'block';
            gameScreen.style.display = 'none';
            gameOverModal.style.display = 'none';
        }
        
        function startGame() {
            mainMenu.style.display = 'none';
            difficultyScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            gameOverModal.style.display = 'none';
            
            if (gameMode === 'single') {
                gameTitle.textContent = 'SINGLE PLAYER';
                player2Name.textContent = 'Computer';
            } else if (gameMode === 'multi') {
                gameTitle.textContent = 'MULTIPLAYER';
                player2Name.textContent = 'Player 2';
            } else if (gameMode === 'crazy') {
                gameTitle.textContent = 'CRAZY MODE';
                player2Name.textContent = 'Crazy AI';
            }
            
            resetGame();
            resetPowerUps();
        }
        
        function resetGame() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'X';
            gameActive = true;
            frozen = false;
            doubleMove = false;
            
            cells.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('x', 'o');
            });
            
            updatePlayerTurn();
            gameOverModal.style.display = 'none';
        }
        
        function resetPowerUps() {
            powerUps = {
                bomb: true,
                swap: true,
                freeze: true,
                double: true
            };
            
            updatePowerUpButtons();
        }
        
        function updatePowerUpButtons() {
            bombPower.classList.toggle('disabled', !powerUps.bomb);
            swapPower.classList.toggle('disabled', !powerUps.swap);
            freezePower.classList.toggle('disabled', !powerUps.freeze);
            doublePower.classList.toggle('disabled', !powerUps.double);
        }
        
        function makeMove(cell) {
            const index = parseInt(cell.getAttribute('data-index'));
            
            if (gameBoard[index] !== '' || !gameActive) {
                return;
            }
            
            gameBoard[index] = currentPlayer;
            cell.textContent = currentPlayer;
            cell.classList.add(currentPlayer.toLowerCase());
            
            playSound('move');
            
            // Create explosion effect at cell position
            const rect = cell.getBoundingClientRect();
            createExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2);
            
            if (checkWin()) {
                endGame(false);
            } else if (checkDraw()) {
                endGame(true);
            } else {
                // Handle double move power-up
                if (doubleMove) {
                    doubleMove = false;
                    showPowerNotification("Double Move Activated! Go again!");
                    return; // Don't switch players
                }
                
                // Switch players unless frozen
                if (!frozen) {
                    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                    updatePlayerTurn();
                    
                    // AI move
                    if ((gameMode === 'single' || gameMode === 'crazy') && currentPlayer === 'O') {
                        setTimeout(makeComputerMove, 500);
                    }
                } else {
                    frozen = false;
                    showPowerNotification("Opponent Frozen! Go again!");
                    updatePlayerTurn();
                }
            }
        }
        
        function makeComputerMove() {
            if (!gameActive) return;
            
            let index;
            
            if (gameMode === 'crazy') {
                // In crazy mode, AI has a chance to use power-ups
                if (Math.random() < 0.3) {
                    const availablePowerUps = Object.keys(powerUps).filter(power => powerUps[power]);
                    if (availablePowerUps.length > 0) {
                        const randomPower = availablePowerUps[Math.floor(Math.random() * availablePowerUps.length)];
                        
                        switch (randomPower) {
                            case 'bomb':
                                useComputerBombPower();
                                return;
                            case 'swap':
                                useComputerSwapPower();
                                return;
                            case 'freeze':
                                useComputerFreezePower();
                                return;
                            case 'double':
                                useComputerDoublePower();
                                return;
                        }
                    }
                }
            }
            
            if (difficulty === 'easy') {
                index = getRandomMove();
            } else if (difficulty === 'medium') {
                index = Math.random() < 0.5 ? getBestMove() : getRandomMove();
            } else if (difficulty === 'hard') {
                index = getBestMove();
            } else if (difficulty === 'insane') {
                // Insane AI: Always makes the best move and has a chance to predict player's next move
                index = getInsaneMove();
            }
            
            if (index !== -1) {
                const cell = cells[index];
                gameBoard[index] = currentPlayer;
                cell.textContent = currentPlayer;
                cell.classList.add(currentPlayer.toLowerCase());
                
                playSound('move');
                
                // Create explosion effect at cell position
                const rect = cell.getBoundingClientRect();
                createExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2);
                
                if (checkWin()) {
                    endGame(false);
                } else if (checkDraw()) {
                    endGame(true);
                } else {
                    currentPlayer = 'X';
                    updatePlayerTurn();
                }
            }
        }
        
        function getRandomMove() {
            const availableMoves = [];
            
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    availableMoves.push(i);
                }
            }
            
            if (availableMoves.length > 0) {
                return availableMoves[Math.floor(Math.random() * availableMoves.length)];
            }
            
            return -1;
        }
        
        function getBestMove() {
            // Check if computer can win
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    if (checkWinForPlayer('O')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // Check if player can win and block
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'X';
                    if (checkWinForPlayer('X')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // Take center if available
            if (gameBoard[4] === '') {
                return 4;
            }
            
            // Take a corner
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(corner => gameBoard[corner] === '');
            
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }
            
            // Take a side
            const sides = [1, 3, 5, 7];
            const availableSides = sides.filter(side => gameBoard[side] === '');
            
            if (availableSides.length > 0) {
                return availableSides[Math.floor(Math.random() * availableSides.length)];
            }
            
            return getRandomMove();
        }
        
        function getInsaneMove() {
            // First, try to win
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    if (checkWinForPlayer('O')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // Then, block player from winning
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'X';
                    if (checkWinForPlayer('X')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // Create a fork (two winning opportunities)
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    let forkCount = 0;
                    
                    // Check how many winning opportunities this creates
                    for (let j = 0; j < gameBoard.length; j++) {
                        if (gameBoard[j] === '') {
                            gameBoard[j] = 'O';
                            if (checkWinForPlayer('O')) {
                                forkCount++;
                            }
                            gameBoard[j] = '';
                        }
                    }
                    
                    gameBoard[i] = '';
                    
                    if (forkCount >= 2) {
                        return i;
                    }
                }
            }
            
            // Block player's fork
            let playerForkIndex = -1;
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'X';
                    let forkCount = 0;
                    
                    // Check how many winning opportunities this creates for player
                    for (let j = 0; j < gameBoard.length; j++) {
                        if (gameBoard[j] === '') {
                            gameBoard[j] = 'X';
                            if (checkWinForPlayer('X')) {
                                forkCount++;
                            }
                            gameBoard[j] = '';
                        }
                    }
                    
                    gameBoard[i] = '';
                    
                    if (forkCount >= 2) {
                        playerForkIndex = i;
                        break;
                    }
                }
            }
            
            // If player can create a fork, force them to block
            if (playerForkIndex !== -1) {
                // Look for a move that creates a two-in-a-row for the computer
                for (let i = 0; i < gameBoard.length; i++) {
                    if (gameBoard[i] === '') {
                        gameBoard[i] = 'O';
                        let twoInRowCount = 0;
                        
                        // Check how many two-in-a-rows this creates
                        for (let j = 0; j < gameBoard.length; j++) {
                            if (gameBoard[j] === '') {
                                gameBoard[j] = 'O';
                                
                                // Check if this creates a two-in-a-row
                                for (let k = 0; k < gameBoard.length; k++) {
                                    if (gameBoard[k] === '') {
                                        gameBoard[k] = 'O';
                                        if (checkWinForPlayer('O')) {
                                            twoInRowCount++;
                                        }
                                        gameBoard[k] = '';
                                    }
                                }
                                
                                gameBoard[j] = '';
                            }
                        }
                        
                        gameBoard[i] = '';
                        
                        if (twoInRowCount >= 1) {
                            return i;
                        }
                    }
                }
                
                // If no such move, take the fork position
                return playerForkIndex;
            }
            
            // Take center if available
            if (gameBoard[4] === '') {
                return 4;
            }
            
            // Take opposite corner if player is in a corner
            const corners = [0, 2, 6, 8];
            const playerCorners = corners.filter(corner => gameBoard[corner] === 'X');
            
            if (playerCorners.length === 1) {
                const playerCorner = playerCorners[0];
                const oppositeCorner = 8 - playerCorner;
                
                if (gameBoard[oppositeCorner] === '') {
                    return oppositeCorner;
                }
            }
            
            // Take an empty corner
            const availableCorners = corners.filter(corner => gameBoard[corner] === '');
            
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }
            
            // Take an empty side
            const sides = [1, 3, 5, 7];
            const availableSides = sides.filter(side => gameBoard[side] === '');
            
            if (availableSides.length > 0) {
                return availableSides[Math.floor(Math.random() * availableSides.length)];
            }
            
            return getRandomMove();
        }
        
        function checkWin() {
            return checkWinForPlayer(currentPlayer);
        }
        
        function checkWinForPlayer(player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                [0, 4, 8], [2, 4, 6]             // Diagonals
            ];
            
            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (gameBoard[a] === player && gameBoard[b] === player && gameBoard[c] === player) {
                    return true;
                }
            }
            
            return false;
        }
        
        function checkDraw() {
            return !gameBoard.includes('');
        }
        
        function endGame(isDraw) {
            gameActive = false;
            
            if (isDraw) {
                gameOverTitle.textContent = "IT'S A DRAW!";
                gameOverMessage.textContent = "NO ONE WINS THIS ROUND!";
                playSound('draw');
            } else {
                const winner = currentPlayer === 'X' ? 
                    (gameMode === 'single' || gameMode === 'crazy' ? 'Player 1' : 'Player 1') : 
                    (gameMode === 'single' || gameMode === 'crazy' ? 'Computer' : 'Player 2');
                
                gameOverTitle.textContent = "GAME OVER!";
                gameOverMessage.textContent = `${winner} WINS!`;
                playSound('win');
                
                // Update scores
                if (currentPlayer === 'X') {
                    player1Score++;
                } else {
                    player2Score++;
                }
                updateScoreDisplay();
                
                // Create confetti effect
                createConfetti();
                
                // Screen shake effect
                screenShake();
            }
            
            setTimeout(() => {
                gameOverModal.style.display = 'flex';
            }, 500);
        }
        
        function updatePlayerTurn() {
            if (currentPlayer === 'X') {
                player1Info.classList.add('current-player');
                player2Info.classList.remove('current-player');
            } else {
                player1Info.classList.remove('current-player');
                player2Info.classList.add('current-player');
            }
        }
        
        function updateScoreDisplay() {
            if (gameMode === 'single' || gameMode === 'crazy') {
                player1ScoreEl.textContent = `Player 1: ${player1Score}`;
                player2ScoreEl.textContent = `Computer: ${player2Score}`;
            } else {
                player1ScoreEl.textContent = `Player 1: ${player1Score}`;
                player2ScoreEl.textContent = `Player 2: ${player2Score}`;
            }
        }
        
        function playSound(soundName) {
            if (soundEnabled && sounds[soundName]) {
                sounds[soundName].currentTime = 0;
                sounds[soundName].play().catch(e => console.log("Audio play error:", e));
            }
        }
        
        function updateSoundIcon() {
            if (soundEnabled && musicEnabled) {
                soundIcon.className = 'fas fa-volume-up';
            } else {
                soundIcon.className = 'fas fa-volume-mute';
            }
        }
        
        // Power-up functions
        function useBombPower() {
            if (!powerUps.bomb) return;
            
            powerUps.bomb = false;
            updatePowerUpButtons();
            
            playSound('explosion');
            showPowerNotification("Bomb Power-Up Used!");
            
            // Find all cells with marks
            const markedCells = [];
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] !== '') {
                    markedCells.push(i);
                }
            }
            
            if (markedCells.length > 0) {
                // Clear a random marked cell
                const randomIndex = markedCells[Math.floor(Math.random() * markedCells.length)];
                gameBoard[randomIndex] = '';
                cells[randomIndex].textContent = '';
                cells[randomIndex].classList.remove('x', 'o');
                
                // Create explosion effect at cell position
                const rect = cells[randomIndex].getBoundingClientRect();
                createExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2);
                
                // Screen shake effect
                screenShake();
            }
        }
        
        function useSwapPower() {
            if (!powerUps.swap) return;
            
            powerUps.swap = false;
            updatePowerUpButtons();
            
            playSound('swap');
            showPowerNotification("Swap Power-Up Used!");
            
            // Swap all X's and O's
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === 'X') {
                    gameBoard[i] = 'O';
                    cells[i].textContent = 'O';
                    cells[i].classList.remove('x');
                    cells[i].classList.add('o');
                } else if (gameBoard[i] === 'O') {
                    gameBoard[i] = 'X';
                    cells[i].textContent = 'X';
                    cells[i].classList.remove('o');
                    cells[i].classList.add('x');
                }
            }
            
            // Swap current player
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updatePlayerTurn();
            
            // Screen shake effect
            screenShake();
        }
        
        function useFreezePower() {
            if (!powerUps.freeze) return;
            
            powerUps.freeze = false;
            updatePowerUpButtons();
            
            playSound('freeze');
            showPowerNotification("Freeze Power-Up Used!");
            
            // Freeze the opponent
            frozen = true;
            
            // Create freeze effect on all opponent's cells
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === (currentPlayer === 'X' ? 'O' : 'X')) {
                    cells[i].style.backgroundColor = 'rgba(0, 191, 255, 0.3)';
                    
                    setTimeout(() => {
                        cells[i].style.backgroundColor = '';
                    }, 2000);
                }
            }
        }
        
        function useDoublePower() {
            if (!powerUps.double) return;
            
            powerUps.double = false;
            updatePowerUpButtons();
            
            playSound('powerUp');
            showPowerNotification("Double Move Power-Up Used!");
            
            // Activate double move for the next turn
            doubleMove = true;
        }
        
        // Computer power-up functions
        function useComputerBombPower() {
            if (!powerUps.bomb) return;
            
            powerUps.bomb = false;
            updatePowerUpButtons();
            
            playSound('explosion');
            showPowerNotification("Computer Used Bomb Power-Up!");
            
            // Find all cells with player's marks
            const playerCells = [];
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === 'X') {
                    playerCells.push(i);
                }
            }
            
            if (playerCells.length > 0) {
                // Clear a random player cell
                const randomIndex = playerCells[Math.floor(Math.random() * playerCells.length)];
                gameBoard[randomIndex] = '';
                cells[randomIndex].textContent = '';
                cells[randomIndex].classList.remove('x');
                
                // Create explosion effect at cell position
                const rect = cells[randomIndex].getBoundingClientRect();
                createExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2);
                
                // Screen shake effect
                screenShake();
            }
            
            // Make a move after using power-up
            setTimeout(makeComputerMove, 1000);
        }
        
        function useComputerSwapPower() {
            if (!powerUps.swap) return;
            
            powerUps.swap = false;
            updatePowerUpButtons();
            
            playSound('swap');
            showPowerNotification("Computer Used Swap Power-Up!");
            
            // Swap all X's and O's
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === 'X') {
                    gameBoard[i] = 'O';
                    cells[i].textContent = 'O';
                    cells[i].classList.remove('x');
                    cells[i].classList.add('o');
                } else if (gameBoard[i] === 'O') {
                    gameBoard[i] = 'X';
                    cells[i].textContent = 'X';
                    cells[i].classList.remove('o');
                    cells[i].classList.add('x');
                }
            }
            
            // Screen shake effect
            screenShake();
            
            // Make a move after using power-up
            setTimeout(makeComputerMove, 1000);
        }
        
        function useComputerFreezePower() {
            if (!powerUps.freeze) return;
            
            powerUps.freeze = false;
            updatePowerUpButtons();
            
            playSound('freeze');
            showPowerNotification("Computer Used Freeze Power-Up!");
            
            // Freeze the player
            frozen = true;
            
            // Create freeze effect on all player's cells
            for (let i = 0; i < gameBoard.length; i++) {
                if (gameBoard[i] === 'X') {
                    cells[i].style.backgroundColor = 'rgba(0, 191, 255, 0.3)';
                    
                    setTimeout(() => {
                        cells[i].style.backgroundColor = '';
                    }, 2000);
                }
            }
            
            // Make a move after using power-up
            setTimeout(makeComputerMove, 1000);
        }
        
        function useComputerDoublePower() {
            if (!powerUps.double) return;
            
            powerUps.double = false;
            updatePowerUpButtons();
            
            playSound('powerUp');
            showPowerNotification("Computer Used Double Move Power-Up!");
            
            // Make two moves in a row
            makeComputerMove();
            
            setTimeout(() => {
                if (gameActive) {
                    makeComputerMove();
                }
            }, 1000);
        }
        
        // Initialize the game
        createFloatingShapes();
        showMainMenu();
        updateSoundIcon();
        
        // Handle page visibility changes to pause/resume music
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                backgroundMusic.pause();
            } else if (musicEnabled) {
                backgroundMusic.play().catch(e => console.log("Music play error:", e));
            }
        });
    </script>
</body>
</html>